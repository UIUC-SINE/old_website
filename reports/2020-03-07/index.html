<!DOCTYPE html>
<html lang=en>

<head>
    <title>ML Solution to Registration</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/codehilite.css" /> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/mathtex-script-type.min.js" defer></script> 

</head>
<body>
<main>
  <article>
    <header>
      <h1>ML Solution to Registration</h1>
      <time datetime="2020-03-07">2020-03-07</time> - Evan Widloski
    </header>
    <h1 id="deriving-ml-solution-to-multiframe-cross-correlation">Deriving ML Solution to Multiframe Cross Correlation</h1>
<p>In this section, I attempt to justify why my extension of Guizar's registration method uses phase correlations of all possible pairs of frames and not just adjacent frame pairs or correlations between the first and Nth frame.</p>
<p>First I derive the ML solution for the two-frame case then extend it to multiple frames.</p>
<h4 id="two-frames">Two Frames</h4>
<p>Assumptions:</p>
<ul>
<li>Original image <script type="math/tex">\mu</script> is known</li>
<li>Image is circularly shifted rather than linearly</li>
</ul>
<p>Let <script type="math/tex">\mu = \left[ \mu_1, ..., \mu_N \right]^T</script> be an image.</p>
<p>Let <script type="math/tex">C_k(\cdot)</script> be a circular shift operator by <script type="math/tex">k</script> positions.</p>
<p>Let <script type="math/tex">Y = \left[Y_1, ..., Y_N\right]^T \sim \mathcal{N}(C_k(\mu), \sigma^2)</script> be a noisy observation of <script type="math/tex">\mu</script> shifted by <script type="math/tex">k</script>.</p>
<p>The likelihood of <script type="math/tex">Y</script> is</p>
<p>
<script type="math/tex; mode=display">P(Y | k) = \prod_{n=1}^N P(Y_n | k) = \prod_{n=1}^N \phi \left( \frac{Y_n - C_k(\mu)_n}{\sigma} \right)</script>
</p>
<p>And the ML solution for <script type="math/tex">k</script> is</p>
<p>
<script type="math/tex; mode=display">
\begin{aligned} \hat{k}_{ML} &= \arg \max_k \ln P(Y | k) = \arg \max_k \sum_{n=1}^N \ln \text{exp} \left[- \frac{(Y_n - C_k(\mu)_n)^2}{\sigma^2} \right] \\
&= \arg \min \sum_{n=1}^N \left[Y_n - C_k(\mu)_n\right]^2 \\
&= \arg \min_k \sum_{n=1}^N Y_n^2 - 2\sum_{n=1}^N Y_n C_k(\mu)_n + \sum_{n=1}^N \mu_n^2 \\
&= \arg \max_k \underbrace{\sum_{n=1}^N Y_n C_k(\mu)_n}_{\text{cross correlation}}
= \arg \max_k (Y \ast \mu)[k]
\end{aligned}
</script>
</p>
<p>Conclusion: <strong>The ML solution for the two frame case is argmax of the cross correlation.</strong></p>
<h4 id="multiple-frames">Multiple Frames</h4>
<p>Assumptions:</p>
<ul>
<li>Original image <script type="math/tex">\mu</script> is known</li>
<li>Image is circularly shifted rather than linearly</li>
</ul>
<p>Let <script type="math/tex">\mu = \left[ \mu_1, ..., \mu_N \right]^T</script> be an image.</p>
<p>Let <script type="math/tex">C_k(\cdot)</script> be a circular shift operator by <script type="math/tex">k</script> positions. <script type="math/tex">k</script> represents the drift velocity.</p>
<p>Let <script type="math/tex">Y_m = \left[Y_1, ..., Y_N\right]^T \sim \mathcal{N}(C_k(\mu), \sigma^2)</script> be the mth noisy observation of <script type="math/tex">\mu</script> shifted by <script type="math/tex">km</script> in a sequence of <script type="math/tex">M</script> frames.</p>
<p>The likelihood of <script type="math/tex">Y_1, ..., Y_M</script> is</p>
<p>
<script type="math/tex; mode=display">
\begin{aligned}
P(Y_1, ..., Y_M | k) &= \prod_{m=1}^M P(Y_m | k) = \prod_{m=1}^M \prod_{n=1}^N P(Y_{m,n} | k) \\
&= \prod_{m=1}^M \prod_{n=1}^N \phi \left(\frac{Y_{m,n} - C_{km}(\mu)_n}{\sigma} \right)
\end{aligned}
</script>
</p>
<p>And the ML solution for <script type="math/tex">k</script> is</p>
<p>
<script type="math/tex; mode=display">
\begin{aligned}
\hat{k}_{ML} &= \arg \max \ln P(Y_1, ..., Y_m | k) \\
&= \arg \max_k \sum_{m=1}^M \sum_{n=1}^N \ln \text{exp} \left[- \frac{(Y_{m,n} - C_{km}(\mu)_n)^2}{\sigma^2} \right] \\
&= \arg \min_k \sum_{m=1}^M \sum_{n=1}^N \left[ Y_{m,n} - C_{km}(\mu)_n \right]^2 \\
&= \arg \min_k \sum_{m=1}^M \sum_{n=1}^N Y_{m,n}^2 - 2Y_{m,n}C_{km}(\mu)_n + \mu_n^2 \\
&= \arg \max_k \sum_{m=1}^M \underbrace{\sum_{n=1}^N Y_{m,n}C_{km}(\mu)_n}_{\text{cross corr. of }Y_m\text{ and }\mu}
\end{aligned}
</script>
</p>
<p>According to this expression, the maximum likelihood solution is an argmax of the sum of cross correlations of all <script type="math/tex">Y_m</script> with <script type="math/tex">\mu</script>.</p>
<p>We can't apply this formula directly since <script type="math/tex">\mu</script> is not known.  However, we can substitute an estimator, such as</p>
<p>
<script type="math/tex; mode=display">\hat{\mu} = \text{mean}\left[C_{-1k}(Y_1), C_{-2k}(Y_2), ..., C_{-Mk}(Y_M)\right]</script>.</p>
<p>Substituting this for <script type="math/tex">\mu</script>, we see that the solution involves a cross correlation of each observation with all other observations.</p>
<p>Conclusion: <strong>The ML solution for the multi-frame case involves cross-correlating all possible pairs </strong> <script type="math/tex">(Y_{m_1}, Y_{m_2}), m_1 < m_2</script>.</p>
  </article>
</main>
<footer>
    <p>All source code and data available <a href="https://github.com/UIUC-SINE/uiuc-sine.github.io">here</a></p>
    <p>SINE UIUC</p>
</footer>
</body>
</html>