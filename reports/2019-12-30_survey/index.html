<!DOCTYPE html>
<html lang=en>

<head>
    <title>Registration Results for Nanoflare drifts</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/codehilite.css" /> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/mathtex-script-type.min.js" defer></script> 



</head>
<body>
<main>
  <article>
    <header>
      <h1>Registration Results for Nanoflare drifts</h1>
      <time datetime="2019-12-30">2019-12-30</time> - Evan
    </header>
    <p>This week I spent time extending the registration method by Guizar-Sicairos, Thurman, Fienup <sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup> to a multiframe setting.</p>
<p>In this report, I give a mathematical formulation of this extension, as well as mathematical descriptions of our earlier ad hoc multiframe methods.</p>
<p>Finally, I compare error of the 3 methods at various drift angles, drift velocities and photon arrival counts.</p>
<h2 id="adhoc-multiframe-1">Adhoc Multiframe #1</h2>
<p>Assuming constant linear drift, cross-correlations between adjacent frames should all contain an identical delta at a location corresponding to the drift vector.  These cross correlations can then be summed to help eliminate noise.</p>
<p>Similarly, this process can be repeated for pairs of frames separated by <script type="math/tex">k=2, 3, 4, ...</script> time steps.  This is illustrated below.</p>
<p>
<figure><img src="corr_sum.jpg" /><figcaption>Visualization of computing <script type="math/tex">CS_1</script> and <script type="math/tex">CS_2</script>. <script type="math/tex">i_1</script>, ..., <script type="math/tex">i_5</script> are the nanoflare video frames</figcaption>
</figure>
</p>
<p>We call the images generated by this process <em>correlation sums</em>, denoted as <script type="math/tex">CS_k</script>
</p>
<p>Since <script type="math/tex">CS_k</script> is a sum of cross-correlations of frames separated by <script type="math/tex">k</script> time steps, the location of the delta is scaled by <script type="math/tex">k</script>.</p>
<p>Finally, we can obtain an estimate for the drift vector by taking argmax of the correlation sums, scaling by <script type="math/tex">k</script>, and taking the mean of the result.</p>
<p>
<script type="math/tex; mode=display">
\text{mean} \left[ \frac{\arg \max CS_k}{k} \right]_{k = 1:N-1}
= \text{mean} \left[ \frac{\arg \max \sum_{n=1}^{N-k} \text{CC}(i_n, i_{n + k})}{k} \right]_{k = 1:N-1}
</script>
</p>
<h2 id="adhoc-multiframe-2">Adhoc Multiframe #2</h2>
<p>This method uses the fact that each correlation sum is close to a shifted copy of the previous correlation sum, where the shift amount is equal to the drift vector.</p>
<p>If we again take cross-correlation of these correlation sums, we should end up with a delta in the same position for each, as shown below.</p>
<p><img alt="" src="ulas_multiframe2.jpg" /></p>
<p>Finally, we take argmax of the correlation sum to derive a drift vector estimate.  This process is given mathematically below.</p>
<p>
<script type="math/tex; mode=display">
\arg \max \sum_{k=1}^{N-2} \text{CC} (CS_k, CS_{k + 1})
= \arg \max \sum_{k=1}^{N-2} \text{CC} \left[ \sum_{n=1}^{N-k} \text{CC}(i_n, i_{n + k}), \sum_{n=1}^{N - k - 1} \text{CC}(i_n, i_{n + k + 1})\right]
</script>
</p>
<p>From testing, this method gives consistently lower estimation error than the first method.</p>
<h2 id="extension-of-guizar-sicairos-thurman-fienup-registration">Extension of Guizar-Sicairos, Thurman, Fienup registration</h2>
<h4 id="original-method">Original Method</h4>
<p>The algorithm presented by Guizar-Sicairos, Thurman, Fienup is a 2-step subpixel registration method which first obtains a coarse, whole-pixel drift vector estimate from standard cross-correlation and then refines it by upsampling the cross-correlation with sinc interpolation.</p>
<p>The major argument of this paper is that the refined estimation step can be greatly accelerated by directly evaluating the DFT in a region around the coarse estimate as opposed to a zero-padded FFT technique.</p>
<ol>
<li>
<p>
<script type="math/tex">\text{coarse} = \arg \max \text{CC}(i_1, i_2) = \text{IFFT} \left[ \text{FFT}(i_1) \cdot \overline{\text{FFT}(i_2)} \right]</script>
</p>
</li>
<li>
<p>
<script type="math/tex">\text{fine} = \arg \max \text{UpsampDFT} \left[ \text{FFT}(i_1) \cdot \overline{\text{FFT}(i_2)} \right]</script>
</p>
</li>
</ol>
<p>These coarse and fine estimates are then fused to obtain a complete subpixel registration.</p>
<h4 id="extension">Extension</h4>
<p>To extend this method to a multiframe setting I first substitute the frequency domain product <script type="math/tex">\text{FFT}(i_1) \cdot \overline{\text{FFT}(i_2)}</script> with a similar sum of products for multiple frames</p>
<p>
<script type="math/tex; mode=display">
\text{FFT}(i_1) \cdot \overline{\text{FFT}(i_2)} + \text{FFT}(i_2) \cdot \overline{\text{FFT}(i_3)} + \text{FFT}(i_3) \cdot \overline{\text{FFT}(i_4)} + ...
= \text{IFFT}(CS_1)
</script>
</p>
<p>The algorithm is carried out identically to obtain a multiframe, subpixel drift vector estimate which I denote <script type="math/tex">\text{GS}(CS_1)</script> (for Guizar-Sicairos).</p>
<p>Similar to Ad Hoc method #1, the results can be fused for all correlation sums</p>
<p>
<script type="math/tex; mode=display">\text{mean} \left[ \frac{\arg \max \text{GS}(CS_k)}{k} \right]</script>
</p>
<h2 id="drift-error-results">Drift Error Results</h2>
<p>I tested each of these multiframe registration methods on simulated nanoflare video images under different photon arrival rates, drift velocities, and drift angles.  The Guizar-Sicairos extension usually performs better than the ad hoc methods, especially in the low SNR scenarios.</p>
<p>I repeated each experiment 20 times.  The shaded region around the lines corresponds to +-1 standard deviation.</p>
<p>The error tends to decrease with increasing SNR and decreasing drift velocity, as expected.  One result I found surprising is that the estimation error is fairly independent of drift angle.</p>
<p>
<figure style="max-width:100%"><img src="grid.png" /><figcaption>Drift vector estimation errors for various settings. The orange, green and blue lines correspond to ad hoc methods #1, #2 and Guizar-Sicairos extension respectively.</figcaption></figure>
</p>
<h2 id="summary">Summary</h2>
<ul>
<li>extended subpixel method by Guizar-Sicairos, Thurman, Fienup to multiframe setting</li>
<li>compared three methods in Monte-Carlo simulation under a variety of scenarios</li>
</ul>
<p>Next week I plan to finish the Structured Low-Rank Algorithms paper and come to a conclusion about its applicability to our problem.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://www.osapublishing.org/ol/viewmedia.cfm?uri=ol-33-2-156&amp;seq=0">Guizar-Sicairos, Thurman, Fienup 2008</a>&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
  </article>
</main>
<footer>
    <p>All source code and data available <a href="https://github.com/UIUC-SINE/uiuc-sine.github.io">here</a></p>
    <p>SINE UIUC</p>
</footer>
</body>
</html>